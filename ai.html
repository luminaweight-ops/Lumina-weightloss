<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Lumina AI | Research Info</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{background:#f3f4f6;font-family:system-ui,-apple-system,Segoe UI,sans-serif}
    .card{border:0;border-radius:18px;box-shadow:0 20px 45px rgba(15,23,42,.10)}
    .bubble{border-radius:16px;padding:10px 12px;max-width:85%;white-space:pre-wrap}
    .me{background:#e0f2fe;margin-left:auto}
    .ai{background:#ecfdf5}
    .muted{color:#64748b;font-size:.9rem}
  </style>
</head>
<body>
  <div class="container py-5" style="max-width:900px">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h2 class="mb-0">Lumina AI</h2>
        <div class="muted">Educational info only • No dosing • No medical advice</div>
      </div>
      <a class="btn btn-outline-dark btn-sm" href="index.html">← Back</a>
    </div>

    <div class="card">
      <div class="card-body p-4">
        <div id="productBanner" class="alert alert-info py-2 px-3 d-none mb-3"></div>

        <div id="chat" class="d-grid gap-2" style="min-height:280px"></div>

        <hr class="my-3">

        <form id="chatForm" class="d-flex gap-2">
          <input id="msg" class="form-control" placeholder="Ask a question…" autocomplete="off" />
          <button class="btn btn-success" type="submit">Send</button>
        </form>

        <div class="muted mt-2">
          Tip: ask “What is it?”, “What’s it studied for?”, “What are the known risks/unknowns?”
        </div>
      </div>
    </div>
  </div>

<script>
  const chat = document.getElementById("chat");
  const form = document.getElementById("chatForm");
  const msg  = document.getElementById("msg");
  const banner = document.getElementById("productBanner");

  const params = new URLSearchParams(location.search);
  const product = params.get("product") || "";

  if (product) {
    banner.classList.remove("d-none");
    banner.textContent = `You’re asking about: ${product}`;
  }

  function addBubble(text, who="ai") {
    const div = document.createElement("div");
    div.className = `bubble ${who === "me" ? "me" : "ai"}`;
    div.textContent = text;
    chat.appendChild(div);
    div.scrollIntoView({ behavior: "smooth", block: "end" });
  }

  addBubble("Hey — I can give research-context info (mechanism, what it’s studied for, and safety/unknowns). I can’t help with dosing or injection instructions.", "ai");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const text = msg.value.trim();
    if (!text) return;

    addBubble(text, "me");
    msg.value = "";
    msg.disabled = true;

    try {
      const res = await fetch("/ai-chat", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ message: text, product })
      });

      const data = await res.json();
      addBubble(data.reply || "No response.", "ai");
    } catch (err) {
      addBubble("Something failed calling the AI endpoint. Check Cloudflare logs.", "ai");
    } finally {
      msg.disabled = false;
      msg.focus();
    }
  });
</script>
</body>
</html>

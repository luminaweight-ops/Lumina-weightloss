<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Research Materials Catalogue UK | Lumina Weight</title>
  <meta name="description" content="Browse all Lumina Weight research materials in the UK. Laboratory research use only. Not for human consumption.">
  <meta name="robots" content="index, follow">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <style>
    body{
      background:#f3f4f6;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;
      padding-top:80px;
    }
    .navbar{background:#fff;box-shadow:0 10px 25px rgba(15,23,42,.06)}
    .navbar-brand img{height:36px;margin-right:10px}
    .cart-icon{font-size:1.4rem;cursor:pointer}
    .hero{padding:120px 0 80px;background:radial-gradient(circle at top left,#ecfdf5,#e0f2fe 40%,#eef2ff)}
    .product-card{
      background:#fff;
      border-radius:22px;
      box-shadow:0 18px 40px rgba(15,23,42,.08);
      transition:.2s;
      cursor:pointer;
    }
    .product-card:hover{transform:translateY(-5px)}
    .product-card img{height:200px;object-fit:contain}
    footer{background:#020617;color:#9ca3af;padding:22px 0;font-size:.9rem}
  </style>
</head>

<body>

<nav class="navbar navbar-expand-lg fixed-top">
  <div class="container">
    <a class="navbar-brand d-flex align-items-center" href="index.html">
      <img src="/LuminaLogoBlack.png">
      <strong>Lumina Weight</strong>
    </a>
    <div class="ms-auto">
      <i class="fas fa-shopping-cart cart-icon" onclick="toggleCart()"></i>
      <span id="cart-count" class="badge bg-danger">0</span>
    </div>
  </div>
</nav>

<section class="hero text-center">
  <div class="container">
    <h1 class="fw-bold">All Research Products</h1>
    <p class="text-muted">
      All items supplied strictly for <strong>laboratory research use only</strong>.
      <br>Not for human consumption.
    </p>
  </div>
</section>

<section class="py-5">
  <div class="container">
    <div id="all-products-status" class="text-center text-muted mb-3">Loading products…</div>
    <div class="row g-4" id="all-products-list"></div>
  </div>
</section>

<footer class="text-center">
  © 2025 Lumina Weight — Research Use Only — Not For Human Consumption
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>
/* ---------- IMAGE PATH FIX ---------- */
function imgSrc(image){
  if(!image) return '';
  if(/^https?:\/\//i.test(image)) return image;
  if(image.startsWith('/')) return encodeURI(image);
  return '/' + encodeURI(image);
}

/* ---------- SUPABASE ---------- */
const supabaseClient = supabase.createClient(
  "https://qketnqhfjfxbqiuqevnh.supabase.co",
  "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InFrZXRucWhmamZ4YnFpdXFldm5oIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjQ2NjkzMzAsImV4cCI6MjA4MDI0NTMzMH0.JIrgLIwWIA5Gwu9K4BsgS0Y_jyax2G6irqkaf35aPys"
);

/* ---------- CART ---------- */
let cart = JSON.parse(localStorage.getItem('cart') || '[]');
function saveCart(){ localStorage.setItem('cart',JSON.stringify(cart)); }
function updateCart(){
  document.getElementById('cart-count').textContent =
    cart.reduce((s,i)=>s+i.qty,0);
}
updateCart();

/* ---------- PRODUCTS ---------- */
let products = [];

function renderProducts(){
  const list = document.getElementById('all-products-list');
  const status = document.getElementById('all-products-status');
  status.textContent = '';

  list.innerHTML = products.map((p,i)=>`
    <div class="col-md-3">
      <div class="product-card h-100 p-3" onclick="openModal(${i})">
        <img src="${imgSrc(p.image)}" class="w-100 mb-3">
        <h6 class="fw-bold">${p.name}</h6>
        <p class="text-muted small">Research material — not for human consumption</p>
        <div class="fw-bold fs-5">£${Number(p.price).toFixed(2)}</div>
        <button class="btn btn-success w-100 mt-2"
          ${p.stock===0?'disabled':''}>
          ${p.stock>0?'Add to cart':'Out of stock'}
        </button>
      </div>
    </div>
  `).join('');
}

async function loadProducts(){
  const {data,error} = await supabaseClient
    .from('Products')
    .select('id,name,price,image,stock')
    .order('name',{ascending:true});

  if(error){
    document.getElementById('all-products-status').textContent = 'Failed to load products';
    return;
  }

  products = data;
  renderProducts();
}
loadProducts();

/* ---------- MODAL ---------- */
function openModal(i){
  const p = products[i];
  if(!p || p.stock===0) return;

  cart.push({id:p.id,name:p.name,price:p.price,qty:1,image:p.image});
  saveCart();
  updateCart();
  alert(p.name + ' added to cart');
}

function toggleCart(){
  window.location.href = 'checkout.html';
}
</script>

</body>
</html>
